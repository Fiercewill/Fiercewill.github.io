<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="WM">





<title>å¹³è¡¡å°è½¦è°ƒè½¦ä¿å§†å¼æ•™ç¨‹ | WM&#39;s blog</title>



    <link rel="icon" href="/favicon1.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    



<meta name="generator" content="Hexo 6.3.0"></head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            if (isDark) {
                pagebody.classList.add('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "Â· Dark"
            } else {
                pagebody.classList.remove('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "Â· Light"
            }
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">WM&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">WM&#39;s Blog</a><a id="mobile-toggle-theme">Â·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">å¹³è¡¡å°è½¦è°ƒè½¦ä¿å§†å¼æ•™ç¨‹</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">WM</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">October 5, 2023&nbsp;&nbsp;22:25:29</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/categories/%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/">é‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ³•</a>
                            
                        </span>
                    
                    
                        <span class="post-count">
                    Words:
                        <a href="">4,086</a> 
                        </span>
                             
                    
                        <span class="post-count">
                    Time:
                        <a href="">18min</a> 
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <blockquote>
<p>âœ…ä½œè€…ç®€ä»‹ï¼šå¤§å®¶å¥½æˆ‘æ˜¯ï¼šä¾ å®¢erï¼Œä¸€åæ™®é€šç”µå­ä¿¡æ¯å·¥ç¨‹ä¸“ä¸šçš„å¤§å­¦å­¦ç”Ÿï¼Œå¸Œæœ›ä¸€èµ·åŠªåŠ›ï¼Œä¸€èµ·è¿›æ­¥ï¼</p>
<p>ğŸ“ƒä¸ªäººä¸»é¡µï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_62261692?spm=1000.2115.3001.5343">ä¾ å®¢er</a></p>
<p>ğŸ”¥ç³»åˆ—ä¸“æ ï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_62261692/category_12297151.html?spm=1001.2014.3001.5482">PIDå­¦ä¹ ç¬”è®°</a></p>
</blockquote>
<h1>å‰è¨€</h1>
<blockquote>
<p>ï¼ˆ1ï¼‰ç¡¬ä»¶é€‰å‹æ³¨æ„ç‚¹ï¼šç”µæœºè½¬é€Ÿã€è½®å­å¤§å°</p>
<p>ï¼ˆ2ï¼‰è½¦æ¨¡ç¡¬ä»¶ç»“æ„æ³¨æ„ç‚¹ï¼šè½¦æ¨¡æ•´ä½“çš„é‡é‡è¦åˆ†å¸ƒå‡åŒ€ï¼Œåˆ©äºå¹³è¡¡</p>
<p>ï¼ˆ3ï¼‰ç¡¬ä»¶ä¸»è¦æ¨¡å—ï¼šé™€èºä»ªjy26ã€ç¼–ç å™¨ç”µæœºã€æ˜¾ç¤ºå±ã€é©±åŠ¨ã€ä¸»æ§ã€ç”µæº</p>
<p>ï¼ˆ4ï¼‰è½¯ä»¶ä¸»è¦æ¨¡å—ï¼šé™€èºä»ªã€ç¼–ç å™¨ã€ç›´ç«‹ç¯ã€é€Ÿåº¦ç¯ã€è½¬å‘ç¯</p>
</blockquote>
<p>è°ƒå‚æ•™ç¨‹ <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1oW4y1Y7nv/?spm_id_from=333.788.top_right_bar_window_history.content.click&amp;vd_source=221d5bfd8774acfce916ac253ceaee25">PIDå¹³è¡¡å°è½¦è°ƒå‚æ•™ç¨‹_å“”å“©å“”å“©_bilibili</a></p>
<h1>ç¡¬ä»¶é€‰å‹</h1>
<h2 id="ç”µæœºçš„é€‰æ‹©">ç”µæœºçš„é€‰æ‹©</h2>
<p>ç”µæœºçš„å…³é”®å‚æ•°ï¼šç”µå‹ã€è½¬é€Ÿ</p>
<p>å‚æ•°æ ‡çš„ç”µå‹ä¸èƒ½ç†è§£ä¸ºç”µæœºæœ€å¤§ä¾›ç”µç”µå‹ï¼Œç”µæœºå®‰å…¨çš„å·¥ä½œçŠ¶æ€ä¸»è¦æ˜¯ç”±äºé€šè¿‡ç”µæœºçš„ç”µæµå†³å®šçš„ï¼Œåªæœ‰ç”µæµæ‰ä¼šæŸåç”µæœºï¼Œç”µæµå°çš„è¯ä¸ä¼šæŸåç”µæœºï¼Œæ‰€ä»¥é¢å®šç”µæµæ‰æ˜¯å…³é”®å€¼ã€‚</p>
<p>é‡è¦çš„æ˜¯è½¬é€Ÿçš„é€‰æ‹©ï¼šè½¬å¾—è¶Šå¿«ï¼Œç”µæœºè¾“å‡ºçš„åŠ›çŸ©å°±è¶Šå°ï¼Œå³ç”µæœºäº§ç”Ÿçš„åŠ›é‡è¶Šå°ï¼Œç”µæœºè½¬çš„è¶Šå¿«ï¼Œé‚£åŠ²è‚¯å®šè¶Šå°ï¼Œç”µæœºè½¬çš„è¶Šæ…¢ï¼Œç”µæœºçš„åŠ²å°±è¶Šå¤§ã€‚</p>
<h4 id="å¹³è¡¡è½¦éœ€è¦ç”µæœºçš„åŠ›çŸ©å¤§ä¸€ç‚¹å¥½ã€‚å»ºè®®å»ºè®®6V-150r-minçš„ç”µæœºã€‚">å¹³è¡¡è½¦éœ€è¦ç”µæœºçš„åŠ›çŸ©å¤§ä¸€ç‚¹å¥½ã€‚å»ºè®®å»ºè®®6V 150r/minçš„ç”µæœºã€‚</h4>
<h2 id="è½®å­çš„é€‰æ‹©">è½®å­çš„é€‰æ‹©</h2>
<p>å¹³è¡¡è½¦éœ€è¦æ‘©æ“¦åŠ›è¾ƒå¤§çš„è½®å­ï¼ŒåŒæ—¶è½¦è½®çš„åŠå¾„è¦è¶³å¤Ÿå¤§ï¼Œå¦åˆ™è½¦ä½“çš„é‡å¿ƒå¤ªé«˜æˆ–å¤ªä½éƒ½ä¸åˆ©äºå¹³è¡¡ã€‚</p>
<h1>è½¯ä»¶æ¨¡å—</h1>
<h2 id="é™€èºä»ª">é™€èºä»ª</h2>
<p>è¿™é‡Œæˆ‘ç”¨é’±æ¥è§£å†³äº†éº»çƒ¦çš„é—®é¢˜ï¼Œé‡é‡‘å…¥æ‰‹äº†ä¸€ä¸ªæ€§èƒ½è¾ƒå¥½çš„å…­è½´é™€èºä»ªjy62ã€‚åªéœ€è¦ä½¿ç”¨å•ç‰‡æœºçš„ä¸€ä¸ªä¸²å£ï¼Œè¿™ä¸ªæ¨¡å—å¯¹æ•°æ®çš„å¤„ç†å·²ç»åšçš„å¾ˆæˆåŠŸäº†ã€‚</p>
<h3 id="imu-c">imu.c</h3>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by fazhehy on 2023/7/17.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;platform/platform.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">uint8_t</span> buffer[<span class="number">11</span>];</span><br><span class="line"><span class="type">imu_data_t</span> acceleration, gyroscope, angle;</span><br><span class="line"></span><br><span class="line"><span class="comment">// uart1</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">imu_init</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	SysCtlPeripheralEnable(SYSCTL_PERIPH_GPIOB);</span><br><span class="line">	SysCtlPeripheralEnable(SYSCTL_PERIPH_UART1);</span><br><span class="line">	GPIOPinConfigure(GPIO_PB0_U1RX);</span><br><span class="line">	GPIOPinConfigure(GPIO_PB1_U1TX);</span><br><span class="line">	GPIOPinTypeUART(GPIO_PORTB_BASE, GPIO_PIN_0);</span><br><span class="line">	GPIOPinTypeUART(GPIO_PORTB_BASE, GPIO_PIN_1);</span><br><span class="line">	UARTConfigSetExpClk(UART1_BASE, SysCtlClockGet(), <span class="number">115200</span>, UART_CONFIG_WLEN_8|UART_CONFIG_STOP_ONE|UART_CONFIG_PAR_NONE);</span><br><span class="line">	UARTFIFOEnable(UART1_BASE);</span><br><span class="line">	</span><br><span class="line">	UARTFIFOLevelSet(UART1_BASE, UART_FIFO_TX2_8, UART_FIFO_RX2_8);</span><br><span class="line">	UARTIntEnable(UART1_BASE, UART_INT_RX|UART_INT_RT);</span><br><span class="line">	<span class="type">void</span> <span class="title function_">imu_handler</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line">	UARTIntRegister(UART1_BASE, imu_handler);</span><br><span class="line">	IntPrioritySet(INT_UART1, USER_INT2);</span><br><span class="line">	IntEnable(INT_UART1);</span><br><span class="line">	IntMasterEnable();</span><br><span class="line">    UARTEnable(UART1_BASE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">uint8_t</span> <span class="title function_">get_verify_code</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint32_t</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">uint8_t</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) &#123;</span><br><span class="line">        sum += buffer[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum&amp;<span class="number">0xff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int32_t</span> k = <span class="number">0</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">imu_analysis</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">float</span> last_angle_z = <span class="number">0</span>, angle_z = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">switch</span> (buffer[<span class="number">1</span>]) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x51</span>:</span><br><span class="line">            acceleration.x = (<span class="type">float</span> )((<span class="type">int16_t</span>)(buffer[<span class="number">2</span>]|(buffer[<span class="number">3</span>]&lt;&lt;<span class="number">8</span>)))/<span class="number">32768</span>*<span class="number">16</span>;</span><br><span class="line">            acceleration.y = (<span class="type">float</span> )((<span class="type">int16_t</span>)(buffer[<span class="number">4</span>]|(buffer[<span class="number">5</span>]&lt;&lt;<span class="number">8</span>)))/<span class="number">32768</span>*<span class="number">16</span>;</span><br><span class="line">            acceleration.z = (<span class="type">float</span> )((<span class="type">int16_t</span>)(buffer[<span class="number">6</span>]|(buffer[<span class="number">7</span>]&lt;&lt;<span class="number">8</span>)))/<span class="number">32768</span>*<span class="number">16</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x52</span>:</span><br><span class="line">            gyroscope.x = (<span class="type">float</span> )((<span class="type">int16_t</span>)(buffer[<span class="number">2</span>]|(buffer[<span class="number">3</span>]&lt;&lt;<span class="number">8</span>)))/<span class="number">32768</span>*<span class="number">2000</span>;</span><br><span class="line">            gyroscope.y = (<span class="type">float</span> )((<span class="type">int16_t</span>)(buffer[<span class="number">4</span>]|(buffer[<span class="number">5</span>]&lt;&lt;<span class="number">8</span>)))/<span class="number">32768</span>*<span class="number">2000</span>;</span><br><span class="line">            gyroscope.z = (<span class="type">float</span> )((<span class="type">int16_t</span>)(buffer[<span class="number">6</span>]|(buffer[<span class="number">7</span>]&lt;&lt;<span class="number">8</span>)))/<span class="number">32768</span>*<span class="number">2000</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x53</span>:</span><br><span class="line">            angle.x = (<span class="type">float</span> )((<span class="type">int16_t</span>)(buffer[<span class="number">2</span>]|(buffer[<span class="number">3</span>]&lt;&lt;<span class="number">8</span>)))/<span class="number">32768</span>*<span class="number">180</span>;</span><br><span class="line">            angle.y = (<span class="type">float</span> )((<span class="type">int16_t</span>)(buffer[<span class="number">4</span>]|(buffer[<span class="number">5</span>]&lt;&lt;<span class="number">8</span>)))/<span class="number">32768</span>*<span class="number">180</span>;</span><br><span class="line">            angle_z = (<span class="type">float</span> )((<span class="type">int16_t</span>)(buffer[<span class="number">6</span>]|(buffer[<span class="number">7</span>]&lt;&lt;<span class="number">8</span>)))/<span class="number">32768</span>*<span class="number">180</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (last_angle_z &lt; <span class="number">-90</span> &amp;&amp; angle_z &gt; <span class="number">90</span>)</span><br><span class="line">        k --;</span><br><span class="line">    <span class="keyword">if</span> (last_angle_z &gt; <span class="number">90</span> &amp;&amp; angle_z &lt; <span class="number">-90</span>)</span><br><span class="line">        k ++;</span><br><span class="line"></span><br><span class="line">    last_angle_z = angle_z;</span><br><span class="line"><span class="comment">//    printf(&quot;k:%ld\n&quot;, k);</span></span><br><span class="line">    angle.z = angle_z + (<span class="type">float</span> )k*<span class="number">360</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ERROR   0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DOING   1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SUCCESS 2</span></span><br><span class="line"><span class="type">static</span> <span class="type">uint8_t</span> n = <span class="number">0</span>, state = <span class="number">0</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">imu_handler</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint32_t</span> data;</span><br><span class="line">	</span><br><span class="line">	<span class="type">uint32_t</span> status=UARTIntStatus(UART1_BASE, <span class="literal">true</span>);</span><br><span class="line">	UARTIntClear(UART1_BASE, status);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">while</span>(UARTCharsAvail(UART1_BASE))&#123;</span><br><span class="line">		data = UARTCharGetNonBlocking(UART1_BASE)&amp;<span class="number">0xff</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//	data = UARTCharGet(UART1_BASE)&amp;0xff;</span></span><br><span class="line">	<span class="comment">//	UARTCharPutNonBlocking(UART0_BASE, data);</span></span><br><span class="line">	<span class="comment">//	printf(&quot;data:%d\n&quot;, data);</span></span><br><span class="line">		</span><br><span class="line">		 <span class="keyword">if</span> (state == ERROR)&#123;</span><br><span class="line">			n = <span class="number">0</span>;</span><br><span class="line">		 &#125;</span><br><span class="line"></span><br><span class="line">		buffer[n] = (<span class="type">uint8_t</span>)data;</span><br><span class="line">		<span class="keyword">if</span> (n == <span class="number">0</span>)&#123;</span><br><span class="line">			<span class="keyword">if</span> (buffer[<span class="number">0</span>] == <span class="number">0x55</span>)&#123;</span><br><span class="line">				state = DOING;</span><br><span class="line">			&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">				state = ERROR;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (n == <span class="number">10</span>)&#123;</span><br><span class="line">			<span class="keyword">if</span> (buffer[<span class="number">10</span>] == get_verify_code())&#123;</span><br><span class="line">				state = SUCCESS;</span><br><span class="line">			&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">				state = ERROR;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		n += <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">if</span> (state == SUCCESS)&#123;</span><br><span class="line"><span class="comment">//			printf(&quot;OK\n&quot;);</span></span><br><span class="line">			imu_analysis();</span><br><span class="line">			state = ERROR;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="imu-h">imu.h</h3>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by fazhehy on 2023/7/17.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> IMU_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IMU_H</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="type">float</span> x;</span><br><span class="line">    <span class="type">float</span> y;</span><br><span class="line">    <span class="type">float</span> z;</span><br><span class="line">&#125;<span class="type">imu_data_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">imu_init</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="keyword">extern</span> <span class="type">imu_data_t</span> acceleration, gyroscope, angle;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">/* IMU_H */</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="ä»£ç åˆ†æ">ä»£ç åˆ†æ</h3>
<p>æŒ‰å‡½æ•°åˆ†æ</p>
<h4 id="void-imu-init-ï¼›-imuåˆå§‹åŒ–">void imu_init()ï¼› //imuåˆå§‹åŒ–</h4>
<blockquote>
<p>é™€èºä»ªçš„åˆå§‹åŒ–ï¼Œåˆå§‹åŒ–å¼•è„šï¼Œæ³¨å†Œä¸²å£ä¸­æ–­å‡½æ•°ï¼Œæ‰“å¼€ä¸­æ–­ã€‚</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">imu_init</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	SysCtlPeripheralEnable(SYSCTL_PERIPH_GPIOB);</span><br><span class="line">	SysCtlPeripheralEnable(SYSCTL_PERIPH_UART1);</span><br><span class="line">	GPIOPinConfigure(GPIO_PB0_U1RX);</span><br><span class="line">	GPIOPinConfigure(GPIO_PB1_U1TX);</span><br><span class="line">	GPIOPinTypeUART(GPIO_PORTB_BASE, GPIO_PIN_0);</span><br><span class="line">	GPIOPinTypeUART(GPIO_PORTB_BASE, GPIO_PIN_1);</span><br><span class="line">	UARTConfigSetExpClk(UART1_BASE, SysCtlClockGet(), <span class="number">115200</span>, UART_CONFIG_WLEN_8|UART_CONFIG_STOP_ONE|UART_CONFIG_PAR_NONE);</span><br><span class="line">	UARTFIFOEnable(UART1_BASE);</span><br><span class="line">	</span><br><span class="line">	UARTFIFOLevelSet(UART1_BASE, UART_FIFO_TX2_8, UART_FIFO_RX2_8);</span><br><span class="line">	UARTIntEnable(UART1_BASE, UART_INT_RX|UART_INT_RT);</span><br><span class="line">	<span class="type">void</span> <span class="title function_">imu_handler</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line">	UARTIntRegister(UART1_BASE, imu_handler);</span><br><span class="line">	IntPrioritySet(INT_UART1, USER_INT2);</span><br><span class="line">	IntEnable(INT_UART1);</span><br><span class="line">	IntMasterEnable();</span><br><span class="line">    UARTEnable(UART1_BASE);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="static-uint8-t-get-verify-code-ï¼›-æ•°æ®æ ¡å‡†">static uint8_t get_verify_code()ï¼›//æ•°æ®æ ¡å‡†</h4>
<blockquote>
<p>10ä¸ªä¸ºä¸€ç»„ï¼Œå¯¹ä¸²å£è·å–åˆ°çš„ buffer[i]æ•°æ®è¿›è¡Œæ±‚å’Œã€‚</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">uint8_t</span> <span class="title function_">get_verify_code</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint32_t</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">uint8_t</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) &#123;</span><br><span class="line">        sum += buffer[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum&amp;<span class="number">0xff</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="void-imu-analysis-ï¼›-æ•°æ®åˆ†æ">void imu_analysis()ï¼› //æ•°æ®åˆ†æ</h4>
<blockquote>
<p>å¯¹é™€èºä»ªè·å–åˆ°çš„æ•°æ®è¿›è¡Œå¤„ç†ï¼Œå¾—åˆ°è§’é€Ÿåº¦å’Œè§’åº¦ã€‚</p>
<p>å…¶ä¸­æœ‰ä¸€ä¸ªå¯¹è§’åº¦çš„å·§å¦™å¤„ç†ï¼Œæ˜¯çš„åèˆªè§’ä»¥zè½´ä½œä¸º0åº¦åˆ†ç•Œï¼Œè§£å†³é™€èºä»ªè‡ªèº«å¾—åˆ°è§’åº¦çš„ä¸è¿ç»­æ€§ã€‚</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">if</span> (last_angle_z &lt; <span class="number">-90</span> &amp;&amp; angle_z &gt; <span class="number">90</span>)</span><br><span class="line">        k --;</span><br><span class="line">    <span class="keyword">if</span> (last_angle_z &gt; <span class="number">90</span> &amp;&amp; angle_z &lt; <span class="number">-90</span>)</span><br><span class="line">        k ++;</span><br><span class="line"></span><br><span class="line">    last_angle_z = angle_z;</span><br><span class="line"><span class="comment">//    printf(&quot;k:%ld\n&quot;, k);</span></span><br><span class="line">    angle.z = angle_z + (<span class="type">float</span> )k*<span class="number">360</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int32_t</span> k = <span class="number">0</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">imu_analysis</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">float</span> last_angle_z = <span class="number">0</span>, angle_z = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">switch</span> (buffer[<span class="number">1</span>]) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x51</span>:</span><br><span class="line">            acceleration.x = (<span class="type">float</span> )((<span class="type">int16_t</span>)(buffer[<span class="number">2</span>]|(buffer[<span class="number">3</span>]&lt;&lt;<span class="number">8</span>)))/<span class="number">32768</span>*<span class="number">16</span>;</span><br><span class="line">            acceleration.y = (<span class="type">float</span> )((<span class="type">int16_t</span>)(buffer[<span class="number">4</span>]|(buffer[<span class="number">5</span>]&lt;&lt;<span class="number">8</span>)))/<span class="number">32768</span>*<span class="number">16</span>;</span><br><span class="line">            acceleration.z = (<span class="type">float</span> )((<span class="type">int16_t</span>)(buffer[<span class="number">6</span>]|(buffer[<span class="number">7</span>]&lt;&lt;<span class="number">8</span>)))/<span class="number">32768</span>*<span class="number">16</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x52</span>:</span><br><span class="line">            gyroscope.x = (<span class="type">float</span> )((<span class="type">int16_t</span>)(buffer[<span class="number">2</span>]|(buffer[<span class="number">3</span>]&lt;&lt;<span class="number">8</span>)))/<span class="number">32768</span>*<span class="number">2000</span>;</span><br><span class="line">            gyroscope.y = (<span class="type">float</span> )((<span class="type">int16_t</span>)(buffer[<span class="number">4</span>]|(buffer[<span class="number">5</span>]&lt;&lt;<span class="number">8</span>)))/<span class="number">32768</span>*<span class="number">2000</span>;</span><br><span class="line">            gyroscope.z = (<span class="type">float</span> )((<span class="type">int16_t</span>)(buffer[<span class="number">6</span>]|(buffer[<span class="number">7</span>]&lt;&lt;<span class="number">8</span>)))/<span class="number">32768</span>*<span class="number">2000</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x53</span>:</span><br><span class="line">            angle.x = (<span class="type">float</span> )((<span class="type">int16_t</span>)(buffer[<span class="number">2</span>]|(buffer[<span class="number">3</span>]&lt;&lt;<span class="number">8</span>)))/<span class="number">32768</span>*<span class="number">180</span>;</span><br><span class="line">            angle.y = (<span class="type">float</span> )((<span class="type">int16_t</span>)(buffer[<span class="number">4</span>]|(buffer[<span class="number">5</span>]&lt;&lt;<span class="number">8</span>)))/<span class="number">32768</span>*<span class="number">180</span>;</span><br><span class="line">            angle_z = (<span class="type">float</span> )((<span class="type">int16_t</span>)(buffer[<span class="number">6</span>]|(buffer[<span class="number">7</span>]&lt;&lt;<span class="number">8</span>)))/<span class="number">32768</span>*<span class="number">180</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (last_angle_z &lt; <span class="number">-90</span> &amp;&amp; angle_z &gt; <span class="number">90</span>)</span><br><span class="line">        k --;</span><br><span class="line">    <span class="keyword">if</span> (last_angle_z &gt; <span class="number">90</span> &amp;&amp; angle_z &lt; <span class="number">-90</span>)</span><br><span class="line">        k ++;</span><br><span class="line"></span><br><span class="line">    last_angle_z = angle_z;</span><br><span class="line"><span class="comment">//    printf(&quot;k:%ld\n&quot;, k);</span></span><br><span class="line">    angle.z = angle_z + (<span class="type">float</span> )k*<span class="number">360</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="void-imu-handler-ï¼›-ä¸­æ–­å›è°ƒå‡½æ•°">void imu_handler()ï¼› //ä¸­æ–­å›è°ƒå‡½æ•°</h4>
<blockquote>
<p>å¤„ç†ä¸­æ–­å·¥ä½œã€‚åœ¨è¿™é‡Œé¢è°ƒç”¨imu_analysis()å‡½æ•°ã€‚</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> ERROR   0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DOING   1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SUCCESS 2</span></span><br><span class="line"><span class="type">static</span> <span class="type">uint8_t</span> n = <span class="number">0</span>, state = <span class="number">0</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">imu_handler</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint32_t</span> data;</span><br><span class="line">	</span><br><span class="line">	<span class="type">uint32_t</span> status=UARTIntStatus(UART1_BASE, <span class="literal">true</span>);</span><br><span class="line">	UARTIntClear(UART1_BASE, status);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">while</span>(UARTCharsAvail(UART1_BASE))&#123;</span><br><span class="line">		data = UARTCharGetNonBlocking(UART1_BASE)&amp;<span class="number">0xff</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//	data = UARTCharGet(UART1_BASE)&amp;0xff;</span></span><br><span class="line">	<span class="comment">//	UARTCharPutNonBlocking(UART0_BASE, data);</span></span><br><span class="line">	<span class="comment">//	printf(&quot;data:%d\n&quot;, data);</span></span><br><span class="line">		</span><br><span class="line">		 <span class="keyword">if</span> (state == ERROR)&#123;</span><br><span class="line">			n = <span class="number">0</span>;</span><br><span class="line">		 &#125;</span><br><span class="line"></span><br><span class="line">		buffer[n] = (<span class="type">uint8_t</span>)data;</span><br><span class="line">		<span class="keyword">if</span> (n == <span class="number">0</span>)&#123;</span><br><span class="line">			<span class="keyword">if</span> (buffer[<span class="number">0</span>] == <span class="number">0x55</span>)&#123;</span><br><span class="line">				state = DOING;</span><br><span class="line">			&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">				state = ERROR;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (n == <span class="number">10</span>)&#123;</span><br><span class="line">			<span class="keyword">if</span> (buffer[<span class="number">10</span>] == get_verify_code())&#123;</span><br><span class="line">				state = SUCCESS;</span><br><span class="line">			&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">				state = ERROR;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		n += <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">if</span> (state == SUCCESS)&#123;</span><br><span class="line"><span class="comment">//			printf(&quot;OK\n&quot;);</span></span><br><span class="line">			imu_analysis();</span><br><span class="line">			state = ERROR;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ç›´ç«‹ç¯">ç›´ç«‹ç¯</h2>
<blockquote>
<p>ä½œç”¨ï¼šä½¿å°è½¦ä¿æŒç›´ç«‹ã€‚</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//****************å¹³è¡¡å°è½¦æœºæ¢°é›¶ç‚¹***************</span></span><br><span class="line"><span class="type">float</span> Car_zero = <span class="number">1.0f</span>;    </span><br><span class="line"><span class="comment">//ç›´ç«‹ç¯ </span></span><br><span class="line"><span class="type">float</span> zhili_Kp=<span class="number">95.5f</span>*<span class="number">0.6f</span>;  <span class="comment">//å‡ºç°å¤§å¹…åº¦ä½é¢‘æŒ¯è¡ 95.5f</span></span><br><span class="line"><span class="type">float</span> zhili_Kd=<span class="number">-10.0f</span>*<span class="number">0.6f</span>;    <span class="comment">//å‡ºç°å°å¹…åº¦é«˜é¢‘æŒ¯è¡  *0.6f</span></span><br><span class="line"><span class="type">int</span> zhili_out=<span class="number">0</span>;       <span class="comment">//ç›´ç«‹ç¯è¾“å‡º</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//***********å¹³è¡¡è½¦æ§åˆ¶******************************************</span></span><br><span class="line"><span class="comment">//å‡½æ•°åŠŸèƒ½ï¼šæ§åˆ¶å°è½¦ä¿æŒç›´ç«‹</span></span><br><span class="line"><span class="comment">//Angleï¼šé‡‡é›†åˆ°çš„å®é™…è§’åº¦å€¼  angle.x</span></span><br><span class="line"><span class="comment">//Gyroï¼š é‡‡é›†åˆ°çš„å®é™…è§’é€Ÿåº¦å€¼  gyroscope.x</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">zhili</span><span class="params">(<span class="type">float</span> Angle,<span class="type">float</span> Gyro)</span></span><br><span class="line">&#123;  </span><br><span class="line">   <span class="type">float</span> err;</span><br><span class="line">	 <span class="type">int</span> pwm_zhili;</span><br><span class="line">	 err=Car_zero-Angle;    <span class="comment">//æœŸæœ›å€¼-å®é™…å€¼ï¼Œè¿™é‡ŒæœŸæœ›å°è½¦å¹³è¡¡ï¼Œå› æ­¤æœŸæœ›å€¼å°±æ˜¯æœºæ¢°ä¸­å€¼       </span></span><br><span class="line">	 pwm_zhili=zhili_Kp*err+Gyro*zhili_Kd;<span class="comment">//è®¡ç®—å¹³è¡¡æ§åˆ¶çš„ç”µæœºPWM</span></span><br><span class="line">	 <span class="keyword">return</span> pwm_zhili;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="é€Ÿåº¦ç¯">é€Ÿåº¦ç¯</h2>
<blockquote>
<p>ä½œç”¨ï¼šä½¿å°è½¦å¹³è¡¡å¾—æ›´åŠ ç¨³å®šï¼Œå¹³è¡¡æ•ˆæœæ›´å¥½ã€‚</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">speed_control_100hz</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//å¹³è¡¡è½¦ç›´ç«‹ç¯ä¸Šçš„é€Ÿåº¦ç¯ï¼Œä¸ºä¸ç›´ç«‹ç¯å¤„ç†é€Ÿåº¦ä¸€è‡´ï¼ŒæŠŠä¸‹é¢ä¸¤è¡Œä»£ç æ³¨é‡Šæ‰</span></span><br><span class="line"><span class="comment">//	static uint16_t _cnt=0;</span></span><br><span class="line"><span class="comment">//	_cnt++;	if(_cnt&lt;2)	return;	_cnt=0;//10msæ§åˆ¶ä¸€æ¬¡ 100hzæ˜¯0.005sï¼Œä¸¤ä¸ª100hzå°±æ˜¯10ms</span></span><br><span class="line"></span><br><span class="line">	speed_feedback[<span class="number">0</span>]=smartcar_imu.left_motor_speed_cmps;<span class="comment">//è·å–å·¦è½®å®é™…å€¼  </span></span><br><span class="line">	speed_error[<span class="number">0</span>]=v_target_l-speed_feedback[<span class="number">0</span>];</span><br><span class="line">	speed_error[<span class="number">0</span>]=constrain_float(speed_error[<span class="number">0</span>],-speed_err_max,speed_err_max);</span><br><span class="line">	speed_integral[<span class="number">0</span>]+=speed_ki*speed_error[<span class="number">0</span>];</span><br><span class="line">	speed_integral[<span class="number">0</span>]=constrain_float(speed_integral[<span class="number">0</span>],-speed_integral_max,speed_integral_max);</span><br><span class="line">	speed_output[<span class="number">0</span>]=speed_integral[<span class="number">0</span>]+speed_kp*speed_error[<span class="number">0</span>];</span><br><span class="line">	speed_output[<span class="number">0</span>]=constrain_float(speed_output[<span class="number">0</span>],-speed_ctrl_output_max,speed_ctrl_output_max);</span><br><span class="line"><span class="comment">//	UART_printf(UART0_BASE,&quot;%d\n&quot;,(int)smartcar_imu.left_motor_speed_cmps);</span></span><br><span class="line">		</span><br><span class="line">	speed_feedback[<span class="number">1</span>]=smartcar_imu.right_motor_speed_cmps;<span class="comment">//å³è½®</span></span><br><span class="line">	speed_error[<span class="number">1</span>]=v_target_r-speed_feedback[<span class="number">1</span>];<span class="comment">//æœŸæœ›é€Ÿåº¦å‡å»å®é™…é€Ÿåº¦å¾—åˆ°é€Ÿåº¦è¯¯å·®</span></span><br><span class="line">	speed_error[<span class="number">1</span>]=constrain_float(speed_error[<span class="number">1</span>],-speed_err_max,speed_err_max);<span class="comment">//å¯¹é€Ÿåº¦è¯¯å·®åšçº¦æŸ</span></span><br><span class="line">	speed_integral[<span class="number">1</span>]+=speed_ki*speed_error[<span class="number">1</span>]; <span class="comment">//é€Ÿåº¦ç§¯åˆ†</span></span><br><span class="line">	speed_integral[<span class="number">1</span>]=constrain_float(speed_integral[<span class="number">1</span>],-speed_integral_max,speed_integral_max);<span class="comment">//å¯¹å¾—åˆ°çš„é€Ÿåº¦ç§¯åˆ†åšçº¦æŸ</span></span><br><span class="line">	speed_output[<span class="number">1</span>]=speed_integral[<span class="number">1</span>]+speed_kp*speed_error[<span class="number">1</span>];<span class="comment">//pidå¾—åˆ°è¾“å‡º</span></span><br><span class="line">	speed_output[<span class="number">1</span>]=constrain_float(speed_output[<span class="number">1</span>],-speed_ctrl_output_max,speed_ctrl_output_max);<span class="comment">//å¯¹è¾“å‡ºåšçº¦æŸ</span></span><br><span class="line">	<span class="comment">//UART_printf(UART0_BASE,&quot;%d\n&quot;,(int)smartcar_imu.right_motor_speed_cmps);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="è½¬å‘ç¯">è½¬å‘ç¯</h2>
<blockquote>
<p>ä½œç”¨ï¼šä¼˜åŒ–å°è½¦çš„å¹³è¡¡æ•ˆæœï¼Œå°è½¦ä¸ä¼šå·¦æ‹å’Œå³æ‹ï¼Œåªåœ¨æ­£å‰æ–¹ä¸æ­£åæ–¹è°ƒæ•´è½¦èº«æ¥å¹³è¡¡è½¦ä½“ã€‚</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è½¬å‘ç¯</span></span><br><span class="line"><span class="type">float</span> zhuan_Kp=<span class="number">0.0f</span>;   <span class="comment">//æœŸæœ›å°è½¦è½¬å‘ï¼Œæ­£åé¦ˆ</span></span><br><span class="line"><span class="type">float</span> zhuan_Kd=<span class="number">-10.0f</span>;    <span class="comment">//æŠ‘åˆ¶å°è½¦è½¬å‘ï¼Œè´Ÿåé¦ˆ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//*************************************************************</span></span><br><span class="line"><span class="comment">//å‡½æ•°åŠŸèƒ½ï¼šæ§åˆ¶å°è½¦è½¬å‘</span></span><br><span class="line"><span class="comment">//Set_turnï¼šç›®æ ‡æ—‹è½¬è§’é€Ÿåº¦</span></span><br><span class="line"><span class="comment">//Gyro_Z:é™€èºä»ªZè½´çš„è§’é€Ÿåº¦</span></span><br><span class="line"><span class="comment">//ä¸æ˜¯ä¸€ä¸ªä¸¥æ ¼çš„PDæ§åˆ¶å™¨ï¼Œä¸ºå°è½¦çš„å åŠ æ§åˆ¶</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">zhuan</span><span class="params">(<span class="type">float</span> Set_turn,<span class="type">float</span> Gyro_Z)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> PWM_Out=<span class="number">0</span>; </span><br><span class="line">	<span class="keyword">if</span>(Set_turn==<span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">	 PWM_Out=zhuan_Kd*Gyro_Z; <span class="comment">//æ²¡æœ‰è½¬å‘éœ€æ±‚ï¼ŒKdçº¦æŸå°è½¦è½¬å‘</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(Set_turn!=<span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">	 PWM_Out=zhuan_Kp*Set_turn; <span class="comment">//æœ‰è½¬å‘éœ€æ±‚ï¼ŒKpä¸ºæœŸæœ›å°è½¦è½¬å‘ </span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> PWM_Out;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>è°ƒå‚ä¿å§†çº§æ•™ç¨‹</h1>
<h2 id="1-æœºæ¢°ä¸­å€¼çš„ç¡®å®š">1 æœºæ¢°ä¸­å€¼çš„ç¡®å®š</h2>
<p>ï¼ˆ1ï¼‰æœºæ¢°ä¸­å€¼å°±æ˜¯å°è½¦ç›´ç«‹çŠ¶æ€ä¸‹çš„ç»•xè½´çš„ä¿¯ä»°è§’pitchï¼Œå¯¹è¿™ä¸ªæœºæ¢°ä¸­å€¼çš„è¦æ±‚ä¸æ˜¯ç‰¹åˆ«é«˜ï¼Œå› ä¸ºåœ¨é€Ÿåº¦ç¯çš„ä½œç”¨ä¸‹ï¼Œå°è½¦åœ¨ä¸€å®šèŒƒå›´å†…çš„æœºæ¢°ä¸­å€¼ä¸‹éƒ½èƒ½ä¿æŒå¹³è¡¡ï¼ˆåŠ å…¥é€Ÿåº¦ç¯åï¼Œæœºæ¢°ä¸­å€¼çš„å½±å“ä¸æ˜¯å¾ˆå¤§ï¼‰ï¼Œæ²¡å¿…è¦æŒ‰ç½‘ä¸Šé‚£ç§ä¸¤è¾¹å€’ä¸‹çš„å€¼åŠ èµ·æ¥å–å¹³å‡å€¼çš„æ–¹æ³•æ¥å–æœºæ¢°ä¸­å€¼ã€‚</p>
<p>ï¼ˆ2ï¼‰æˆ‘ä»¬é™¤äº†è¦ç”¨åˆ°ç»•xè½´æ–¹å‘çš„ä¿¯ä»°è§’å¤–ï¼Œè¿˜éœ€è¦ç»•zè½´æ–¹å‘çš„åèˆªè§’æ¥ä½¿å°è½¦çš„å¹³è¡¡æ€§èƒ½æ›´å¥½ã€‚</p>
<p><img src="/2023/10/05/%E5%B9%B3%E8%A1%A1%E5%B0%8F%E8%BD%A6%E8%B0%83%E8%BD%A6%E4%BF%9D%E5%A7%86%E5%BC%8F%E6%95%99%E7%A8%8B/1.png" alt></p>
<h2 id="2-ç›´ç«‹ç¯è°ƒå‚">2 ç›´ç«‹ç¯è°ƒå‚</h2>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">   err=Car_zero-Angle;    <span class="comment">//æœŸæœ›å€¼-å®é™…å€¼ï¼Œè¿™é‡ŒæœŸæœ›å°è½¦å¹³è¡¡ï¼Œå› æ­¤æœŸæœ›å€¼å°±æ˜¯æœºæ¢°ä¸­å€¼       </span></span><br><span class="line">pwm_zhili=zhili_Kp*err+Gyro*zhili_Kd;<span class="comment">//è®¡ç®—å¹³è¡¡æ§åˆ¶çš„ç”µæœºPWM</span></span><br></pre></td></tr></table></figure>
<h3 id="2-1-ç›´ç«‹ç¯Kpææ€§çš„ç¡®å®š">2.1 ç›´ç«‹ç¯Kpææ€§çš„ç¡®å®š</h3>
<p>ç›´ç«‹çš„è¦æ±‚æ˜¯å°è½¦å¾€å“ªè¾¹å€’ï¼Œå°è½¦å°±å¾€å“ªè¾¹åŠ é€Ÿå‰è¿›ï¼Œä½¿å°è½¦å¾—ä»¥å¹³è¡¡ã€‚</p>
<blockquote>
<p>å…ˆç»™ä¸€ä¸ªå¤§çš„På€¼ï¼Œä¾‹å¦‚P=100ï¼Œåœ¨å•ç‹¬çš„ç›´ç«‹ç¯ä½œç”¨ä¸‹ï¼Œå€¾å€’å°è½¦ï¼Œè§‚å¯Ÿå°è½¦çš„è¿åŠ¨çŠ¶æ€ï¼Œæ­£ç¡®Kpææ€§ä¸‹ï¼Œè¿åŠ¨çŠ¶æ€æ˜¯å°è½¦å¾€å“ªè¾¹å€’ï¼Œè½®å­å°±å¾€å“ªè¾¹è½¬ï¼Œæ”¹å˜På€¼çš„æ­£è´Ÿä½¿å°è½¦çš„è¿åŠ¨çŠ¶æ€è¾¾åˆ°è¦æ±‚ã€‚</p>
</blockquote>
<h3 id="2-2-ç›´ç«‹ç¯Kpå¤§å°çš„è°ƒèŠ‚">2.2 ç›´ç«‹ç¯Kpå¤§å°çš„è°ƒèŠ‚</h3>
<p>ï¼ˆ1ï¼‰å…ˆæŠŠKpè®¾æˆä¸€ä¸ªå°çš„å€¼ï¼Œè‹¥å‘ç°è½®å­ä¸è½¬ï¼Œåˆ™æ˜¯Kpçš„å€¼è¿‡å°ã€‚</p>
<p>ï¼ˆ2ï¼‰å°†Kpçš„å€¼å¢å¤§ï¼Œå°è½¦å‘å‰å€¾æ–œï¼Œå°è½¦ä¼šå‘å‰è¿åŠ¨ï¼›å°è½¦å‘åå€¾æ–œï¼Œå°è½¦ä¼šå‘åè¿åŠ¨ï¼Œä½†æ˜¯ç›´ç«‹ä¸èµ·æ¥ï¼Œæ˜¯å› ä¸ºå°è½¦ååº”å¾—å¤ªæ…¢äº†ï¼ŒåŸå› è¿˜æ˜¯Kpè¿‡å°ã€‚</p>
<p>ï¼ˆ3ï¼‰ç»§ç»­å¢å¤§Kpï¼Œå¯ä»¥çœ‹åˆ°å°è½¦æœ‰æ¥è¿‘å¹³è¡¡çš„è¶‹åŠ¿ï¼Œä½†æ˜¯è¿˜æ˜¯å¹³è¡¡ä¸èµ·æ¥ï¼ŒåŸå› æ˜¯Kpçš„å€¼è¿˜æ˜¯å°äº†äº›ã€‚</p>
<p>ï¼ˆ4ï¼‰ç»§ç»­å¢å¤§Kpï¼Œå¯ä»¥çœ‹åˆ°å°è½¦æœ‰æ˜æ˜¾çš„å¹³è¡¡è¶‹åŠ¿ï¼Œå¹³è¡¡æ•ˆæœä¸é”™ã€‚</p>
<p>ï¼ˆ5ï¼‰æ ¹æ®å·¥ç¨‹ç»éªŒï¼Œæˆ‘ä»¬è¦ç»§ç»­å¢å¤§Kpï¼Œç›´åˆ°æ¾æ‰‹è®©å°è½¦ç›´ç«‹æ—¶å‡ºç°ä½é¢‘æŒ¯è¡ã€‚</p>
<p>ï¼ˆ6ï¼‰å°è½¦å‡ºç°ä½é¢‘æŒ¯è¡åï¼Œæ ¹æ®å·¥ç¨‹ç»éªŒï¼Œåœ¨å¢å¤§ä¸€ç‚¹Kpåå¯ä»¥å¼•å…¥Kdåˆ†é‡ã€‚è¿™é‡Œå†å¢å¤§ä¸€ç‚¹Kpï¼Œå°è½¦å‡ºç°æ˜æ˜¾ä½é¢‘æŒ¯è¡ï¼Œæ•ˆæœç¬¦åˆï¼Œæ­¤æ—¶åº”å¿«é€Ÿå…³é—­ç”µæºï¼Œä¸èƒ½è®©ä½é¢‘æŒ¯è¡æŒç»­å¤ªä¹…ã€‚</p>
<h3 id="2-3-ç›´ç«‹ç¯Kdææ€§çš„ç¡®å®š">2.3 ç›´ç«‹ç¯Kdææ€§çš„ç¡®å®š</h3>
<p>Kdä½œç”¨æ˜¯è¾…åŠ©Kpçš„æ•ˆæœï¼Œä½¿å°è½¦ååº”æ›´è¿…é€Ÿï¼Œè¾¾åˆ°å¥½çš„ç›´ç«‹æ•ˆæœã€‚</p>
<blockquote>
<p>å…ˆå°†ç›´ç«‹ç¯Kpç½®ä¸º0ï¼Œå°†Kdç»™ä¸€ä¸ªç¨å¾®å¤§ä¸€ç‚¹çš„å€¼ï¼Œä¾‹å¦‚;Kd=100;æ­£ç¡®Kdææ€§ä¸‹ï¼Œè¿åŠ¨çŠ¶æ€æ˜¯å°è½¦å¾€å“ªè¾¹å€’ï¼Œè½®å­å°±å¾€å“ªè¾¹è½¬ã€‚</p>
</blockquote>
<h3 id="2-4-ç›´ç«‹ç¯Kdå¤§å°çš„è°ƒèŠ‚">2.4 ç›´ç«‹ç¯Kdå¤§å°çš„è°ƒèŠ‚</h3>
<p>ï¼ˆ1ï¼‰æ¢å¤Kpçš„å€¼ï¼Œå…ˆå°†Kdè®¾æˆä¸€ä¸ªè¾ƒå°çš„å€¼ï¼Œä¾‹å¦‚Kd=1ï¼›å¯ä»¥çœ‹åˆ°å°è½¦çš„å¹³è¡¡æ•ˆæœå…¶å®æ¯”è¾ƒå¥½ï¼Œå¯ä»¥åšåˆ°ç¨³å®šå¹³è¡¡ã€‚ä½†æ˜¯æŒ‰ç…§å·¥ç¨‹å®è·µï¼Œæˆ‘ä»¬éœ€è¦ç»§ç»­å¢å¤§Kdå¯»æ‰¾Kdçš„ä¸´ç•Œå€¼ï¼Œç›´åˆ°å°è½¦å‡ºç°é«˜é¢‘æŒ¯è¡ã€‚</p>
<p>ï¼ˆ2ï¼‰å°è½¦å‡ºç°é«˜é¢‘æŒ¯è¡æ—¶ï¼Œéœ€è¦è¿…é€Ÿå…³é—­ç”µæºï¼Œé¿å…å› ä¸ºåé¦ˆç”µæµè¿‡å¤§å¯¼è‡´ç”µæœºé©±åŠ¨æˆ–è€…ç”µæ± çƒ§æ¯ã€‚</p>
<p>ï¼ˆ3ï¼‰å°è½¦å‡ºç°å°èŒƒå›´çš„é«˜é¢‘æŒ¯è¡æ—¶ï¼Œå†å¢å¤§Kdï¼Œå¯ä»¥çœ‹åˆ°å°è½¦å‡ºç°æ˜æ˜¾çš„é«˜é¢‘æŒ¯è¡ã€‚æ­¤æ—¶ï¼Œå¯ä»¥åœæ­¢è°ƒèŠ‚ç›´ç«‹ç¯äº†ã€‚</p>
<p>æŒ‰ç…§å·¥ç¨‹å®è·µï¼Œç»™ç›´ç«‹ç¯çš„Kpå’ŒKdéƒ½ä¹˜ä¸Š0.6ï¼ˆå› ä¸ºæˆ‘ä»¬æ˜¯æŒ‰æŒ¯è¡çš„ç°è±¡æ¥è°ƒçš„ï¼Œæ‰€ä»¥ç›´è¿™é‡Œä¹˜ä»¥0.6å¯ä»¥è®©å°è½¦å¹³è¡¡ï¼‰ã€‚</p>
<h3 id="å•ç‹¬ç›´ç«‹ç¯æ•ˆæœ">å•ç‹¬ç›´ç«‹ç¯æ•ˆæœ</h3>
<p>å°è½¦å¯ä»¥è¾ƒé•¿æ—¶é—´ç›´ç«‹ï¼Œä½†æ˜¯éœ€è¦æ‰‹åŠ¨å»å¹²é¢„å°è½¦çš„è¿åŠ¨çŠ¶æ€ï¼Œä½¿ä»–ç»´æŒå¹³è¡¡ã€‚ä½†æ˜¯æ²¡æœ‰é€Ÿåº¦ç¯çš„åŠ æŒï¼Œå°è½¦ä¸èƒ½å¤Ÿè‡ªå·±åœ¨å¤§èŒƒå›´ç©ºé—´å†…ä¿æŒé•¿æ—¶é—´ç›´ç«‹ã€‚</p>
<h2 id="3-é€Ÿåº¦ç¯è°ƒå‚">3 é€Ÿåº¦ç¯è°ƒå‚</h2>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">speed_feedback[<span class="number">0</span>]=smartcar_imu.left_motor_speed_cmps;<span class="comment">//è·å–å·¦è½®å®é™…å€¼  </span></span><br><span class="line">speed_error[<span class="number">0</span>]=v_target_l-speed_feedback[<span class="number">0</span>];</span><br><span class="line">speed_error[<span class="number">0</span>]=constrain_float(speed_error[<span class="number">0</span>],-speed_err_max,speed_err_max);</span><br><span class="line">speed_integral[<span class="number">0</span>]+=speed_ki*speed_error[<span class="number">0</span>];</span><br><span class="line">speed_integral[<span class="number">0</span>]=constrain_float(speed_integral[<span class="number">0</span>],-speed_integral_max,speed_integral_max);</span><br><span class="line">speed_output[<span class="number">0</span>]=speed_integral[<span class="number">0</span>]+speed_kp*speed_error[<span class="number">0</span>];</span><br><span class="line">speed_output[<span class="number">0</span>]=constrain_float(speed_output[<span class="number">0</span>],-speed_ctrl_output_max,speed_ctrl_output_max);</span><br></pre></td></tr></table></figure>
<h3 id="3-1-é€Ÿåº¦ç¯Kpææ€§çš„ç¡®å®š">3.1 é€Ÿåº¦ç¯Kpææ€§çš„ç¡®å®š</h3>
<p>ï¼ˆ1ï¼‰å…³é—­ç›´ç«‹ç¯</p>
<p>ï¼ˆ2ï¼‰ç»™é€Ÿåº¦ç¯Kpå…ˆè®¾ç«‹ä¸€ä¸ªæ¯”è¾ƒå¤§çš„å€¼ï¼Œç»™é€Ÿåº¦ç¯ä¸€ä¸ªç›®æ ‡å€¼ï¼Œæ­£ç¡®çš„Kpææ€§ä¸‹ï¼Œè½®å­æ˜¯æ­£å¸¸å¿«é€Ÿè½¬åŠ¨çš„ï¼Œå¦åˆ™ï¼Œå°è½¦è½®å­ä¸è½¬ã€‚</p>
<h3 id="3-2-é€Ÿåº¦ç¯Kiææ€§çš„ç¡®å®š">3.2 é€Ÿåº¦ç¯Kiææ€§çš„ç¡®å®š</h3>
<p>æ ¹æ®å·¥ç¨‹å®è·µï¼Œé€Ÿåº¦ç¯çš„Ki = 1/200*Kpï¼Œæ‰€ä»¥åé¢æˆ‘ä»¬é€Ÿåº¦ç¯çš„Kpä¸Kiå¯ä»¥ä¸€èµ·è°ƒã€‚</p>
<blockquote>
<p>ç»™Kpä¸€ä¸ªè¾ƒå°çš„å€¼ï¼ŒKiä¸€ä¸ªæ›´å°çš„å€¼ï¼Œæ¯”Kpå°ä¸€ä¸ªæ•°é‡çº§ï¼Œæ›´æ”¹Kiçš„ææ€§è§‚å¯Ÿè½®å­è½¬åŠ¨æƒ…å†µï¼Œæ­£ç¡®çš„è½¬åŠ¨æƒ…å†µæ˜¯ï¼Œç”¨æ‰‹å°†è½®å­å¾€ä¸€ä¸ªæ–¹å‘è½¬åŠ¨ï¼Œå°è½¦ä¼šæŒ‰è¿™ä¸ªæ–¹å‘æ…¢æ…¢å¢å¤§åˆ°æœ€å¤§è½¬é€Ÿï¼Œä¼šå‡ºç°å°èŒƒå›´çš„æŒ¯è¡å±äºæ­£å¸¸ç°è±¡,é”™è¯¯ææ€§ä¸‹ï¼Œè½®å­ä¼šæŒ‰æ‰‹è½¬åŠ¨çš„åæ–¹å‘è½¬åŠ¨ï¼Œä¸ä¼šæŒ‰åŸæ–¹å‘è½¬åŠ¨åˆ°æœ€å¤§ã€‚</p>
</blockquote>
<h3 id="3-3-é€Ÿåº¦ç¯Kpã€Kdå¤§å°çš„è°ƒèŠ‚">3.3 é€Ÿåº¦ç¯Kpã€Kdå¤§å°çš„è°ƒèŠ‚</h3>
<p>é€Ÿåº¦ç¯çš„Ki = 1/200*Kpï¼Œæˆ‘ä»¬åªéœ€è¦è°ƒèŠ‚Kpå³å¯ã€‚</p>
<p>ï¼ˆ1ï¼‰æ‰“å¼€ç›´ç«‹ç¯ï¼Œåœ¨ç›´ç«‹ç¯åŸºç¡€ä¸Šè°ƒé€Ÿåº¦ç¯ï¼Œä»¥å°è½¦çš„å¹³è¡¡æ•ˆæœä¸ºè°ƒå‚çš„åŸºå‡†ã€‚</p>
<p>ï¼ˆ2ï¼‰å…ˆå°†Kpè®¾æˆä¸€ä¸ªå°çš„å€¼ï¼Œå¯ä»¥çœ‹åˆ°åœ¨é€Ÿåº¦ç¯çš„åŠ æŒä¸‹ï¼Œå°è½¦çš„ç›´ç«‹æ•ˆæœæ›´å¥½ã€‚</p>
<p>ï¼ˆ3ï¼‰ä½†æ˜¯åé¦ˆçš„æ•ˆæœä¾æ—§å¾ˆæ…¢ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ç»§ç»­å¢å¤§é€Ÿåº¦ç¯Kpã€‚</p>
<p>ï¼ˆ4ï¼‰è°ƒèŠ‚åˆ°åˆé€‚çš„Kpï¼Œå°è½¦å¯ä»¥å¾ˆå¥½ä¿æŒå¹³è¡¡ï¼ŒåŒæ—¶è¿˜å…·å¤‡ä¸€å®šæŠ—å‡»æ‰“èƒ½åŠ›ï¼Œå¯ä»¥è¾ƒé•¿æ—¶é—´ç›´ç«‹ã€‚</p>
<p>ï¼ˆ5ï¼‰ä½†æ˜¯å°è½¦åœ¨è‡ªå·±çš„å¹³è¡¡ä¹‹ä¸­ä¼šå‡ºç°æ—‹è½¬ï¼ŒåŒæ—¶åœ¨åŸåœ°å¹³è¡¡æ—¶ä¹Ÿä¼šå‡ºç°çŸ­æœŸæŒ¯è¡ç°è±¡ã€‚</p>
<h3 id="ç›´ç«‹ç¯åŠ é€Ÿåº¦ç¯ç°è±¡">ç›´ç«‹ç¯åŠ é€Ÿåº¦ç¯ç°è±¡</h3>
<p>ï¼ˆ1ï¼‰å°è½¦å¯ä»¥å¾ˆå¥½ä¿æŒå¹³è¡¡ï¼ŒåŒæ—¶è¿˜å…·å¤‡ä¸€å®šæŠ—å‡»æ‰“èƒ½åŠ›ï¼Œå¯ä»¥è¾ƒé•¿æ—¶é—´ç›´ç«‹ã€‚</p>
<p>ï¼ˆ2ï¼‰åŸåœ°å¹³è¡¡æ—¶ä¹Ÿä¼šå‡ºç°çŸ­æœŸæŒ¯è¡ç°è±¡å¯ä»¥é€šè¿‡å¢å¤§ç›´ç«‹ç¯çš„Kdå’Œå‡å°é€Ÿåº¦ç¯çš„Kpæ¥æŠµæ¶ˆè¿™ä¸ªæƒ…å†µï¼Œæ…¢æ…¢è°ƒæ•´å¯ä»¥è¾¾åˆ°ä¸€ä¸ªå¥½çš„æ•ˆæœï¼Œè¿™ä¸ªæ¯”è¾ƒéº»çƒ¦ï¼Œéœ€è¦é•¿æ—¶é—´çš„è€å¿ƒã€‚</p>
<p>ï¼ˆ3ï¼‰æ—‹è½¬çš„æƒ…å†µæˆ‘ä»¬å¯ä»¥é€šè¿‡åŠ å…¥è½¬å‘ç¯æ¥æŠ‘åˆ¶ã€‚</p>
<h2 id="4-è½¬å‘ç¯è°ƒå‚">4 è½¬å‘ç¯è°ƒå‚</h2>
<p>è½¬å‘ç¯è‹¥æ˜¯ä¸ºäº†è®©å°è½¦ä¿æŒä¸€ä¸ªæ–¹å‘ä¸Šçš„åŸåœ°é™æ­¢ï¼Œæ‰€ä»¥ä¸éœ€è¦Kpï¼Œä»…åŠ å…¥Kdå³å¯ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(Set_turn==<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"> PWM_Out=zhuan_Kd*Gyro_Z; <span class="comment">//æ²¡æœ‰è½¬å‘éœ€æ±‚ï¼ŒKdçº¦æŸå°è½¦è½¬å‘</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(Set_turn!=<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"> PWM_Out=zhuan_Kp*Set_turn; <span class="comment">//æœ‰è½¬å‘éœ€æ±‚ï¼ŒKpä¸ºæœŸæœ›å°è½¦è½¬å‘ </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-1-è½¬å‘ç¯Kdææ€§çš„ç¡®å®š">4.1 è½¬å‘ç¯Kdææ€§çš„ç¡®å®š</h3>
<p>å°†ç›´ç«‹ç¯å’Œé€Ÿåº¦ç¯å…³é—­ï¼Œå°†Kdè®¾ä¸º100ã€‚æ­£ç¡®Kpææ€§ä¸‹å°è½¦çš„è¿åŠ¨çŠ¶æ€æ˜¯ï¼Œé¡ºæ—¶é’ˆè½¬åŠ¨å°è½¦ï¼Œè½®å­äº§ç”Ÿçš„ä½œç”¨å¯ä»¥æŠµæŠ—å°è½¦é¡ºæ—¶é’ˆè½¬åŠ¨ï¼Œäº§ç”Ÿå¯¹æŠ—æ—‹è½¬çš„æ‰­çŸ©ã€‚</p>
<h3 id="4-2-è½¬å‘ç¯Kdå¤§å°çš„ç¡®å®š">4.2 è½¬å‘ç¯Kdå¤§å°çš„ç¡®å®š</h3>
<p>ï¼ˆ1ï¼‰å¼€å¯ç›´ç«‹ç¯å’Œé€Ÿåº¦ç¯</p>
<p>ï¼ˆ2ï¼‰ä»å°åˆ°å¤§è°ƒæ•´Kdçš„å€¼ï¼Œåˆé€‚çš„Kdå¯ä»¥ä½¿å°è½¦åœ¨å¹³è¡¡è¿‡ç¨‹ä¸­ä¸å‘ç”Ÿæ°´å¹³æ–¹å‘çš„è½¬åŠ¨</p>
<p>ï¼ˆ3ï¼‰è‹¥æœ‰å¹³è¡¡è¿‡ç¨‹ä¸­å°è½¦æœ‰æ—‹è½¬è¶‹åŠ¿ï¼Œè¯´æ˜Kdçš„å€¼è¿˜æ˜¯è¿‡å°ï¼Œåˆ™éœ€è¦ç»§ç»­å¢å¤§Kdçš„å€¼ã€‚</p>
<p>ï¼ˆ4ï¼‰è‹¥å°è½¦å‡ºç°æ˜æ˜¾çš„é«˜é¢‘æŒ¯è¡ï¼Œè¯´æ˜Kdè¿‡å¤§äº†ã€‚</p>
<h2 id="5-æ‹¿èµ·ä¸æ”¾ä¸‹å°è½¦æ£€æµ‹">5 æ‹¿èµ·ä¸æ”¾ä¸‹å°è½¦æ£€æµ‹</h2>
<p>æ‹¿èµ·æ£€æµ‹æ€è·¯æ˜¯å½“è½®å­ä»¥è¾ƒå¤§é€Ÿåº¦æ—‹è½¬ä¸€æ®µæ—¶é—´åï¼Œå…³é—­ç”µæœºï¼›</p>
<p>æ”¾ä¸‹æ£€æµ‹æ€è·¯æ˜¯å½“ä¿¯ä»°è§’è¿‡å¤§æ—¶å…³é—­ç”µæœºã€‚</p>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>WM</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="https://fiercewill.github.io/2023/10/05/%E5%B9%B3%E8%A1%A1%E5%B0%8F%E8%BD%A6%E8%B0%83%E8%BD%A6%E4%BF%9D%E5%A7%86%E5%BC%8F%E6%95%99%E7%A8%8B/">https://fiercewill.github.io/2023/10/05/%E5%B9%B3%E8%A1%A1%E5%B0%8F%E8%BD%A6%E8%B0%83%E8%BD%A6%E4%BF%9D%E5%A7%86%E5%BC%8F%E6%95%99%E7%A8%8B/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>ç”µå­ä¿¡æ¯å·¥ç¨‹ (A) 2023 <a href="https://fiercewill.github.io/categories/STM32%E7%AC%94%E8%AE%B0/">STM32ç¬”è®°</a> . <a href="https://fiercewill.github.io/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%EF%BC%88C%E8%AF%AD%E8%A8%80%EF%BC%89/">æ•°æ®ç»“æ„ä¸ç®—æ³•ï¼ˆcè¯­è¨€ï¼‰</a> . <a href="https://fiercewill.github.io/categories/%E6%99%BA%E8%83%BD%E8%BD%A6%E7%AB%9E%E8%B5%9B/">æ™ºèƒ½è½¦ç«èµ›</a> ç‹æ˜çš„åšå®¢</span>
                    </p>
                
                
                     <p class="copyright-item">
                         <span>Slogan:</span>
                         <span>åœ¨ä½ æœ€è™šå¼±çš„æ—¶å€™ï¼Œ<strong>æœ€å¼ºç‰ˆæœ¬</strong>çš„ä½ æ­£åœ¨å‡†å¤‡<strong>ç™»åœº</strong>ã€‚</span>
                     </p>
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/tips/">ğŸ·ï¸ tips</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>Â· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2023/10/09/C%E8%AF%AD%E8%A8%80%E5%88%B7%E9%A2%98%EF%BC%88Day2%EF%BC%89/">Cè¯­è¨€åˆ·é¢˜ï¼ˆDay2ï¼‰</a>
            
            
            <a class="next" rel="next" href="/2023/10/04/STM32%E9%A9%B1%E5%8A%A8%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA/">STM32é©±åŠ¨æ­¥è¿›ç”µæœº</a>
            
        </section>


    </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>Â© WM | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a>
		
		  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<span class="site-uv">
    æ€»è®¿å®¢é‡:
    <i class="busuanzi-value" id="busuanzi_value_site_uv"></i>
</span>&nbsp;


<span class="site-pv">
    æ€»è®¿é—®é‡:
    <i class="busuanzi-value" id="busuanzi_value_site_pv"></i>
</span>


		
        </span>
    </div>
</footer>
<link rel="stylesheet" href="/dist/APlayer.min.css">
<div id="aplayer"></div>
<script type="text/javascript" src="/dist/APlayer.min.js"></script>
<script type="text/javascript" src="/dist/music.js"></script>
    </div>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/haruto.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>
<canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas> 
<script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script> 
<script type="text/javascript" src="\js\FunnyTitle.js"></script>
<script type="text/javascript" src="http://libs.baidu.com/jquery/1.8.3/jquery.js"></script>
<script type="text/javascript" src="http://libs.baidu.com/jquery/1.8.3/jquery.min.js"></script>
<script type="text/javascript" src="\js\snow.js"></script>
<script type="text/javascript" src="/js/fireworks.js"></script>
<!--æµè§ˆå™¨æç¬‘æ ‡é¢˜-->
<!-- é›ªèŠ±ç‰¹æ•ˆ -->

